:root {
  --bg: linear-gradient(180deg,#f8fafc 0%,#eef2ff 100%);
  --card:#fff;
  --ink:#0f172a;
  --muted:#475569;
  --accent:#2563eb;
  --accent2:#10b981;
  --border:#e2e8f0;
  --shadow:0 10px 30px rgba(2,6,23,.08);
  --switch-handle:#fff;
}

@media (prefers-color-scheme: dark) {
  :root {
    --bg: linear-gradient(180deg,#0f172a 0%,#1e293b 100%);
    --card:#1e293b;
    --ink:#f1f5f9;
    --muted:#cbd5e1;
    --accent:#3b82f6;
    --accent2:#34d399;
    --border:#334155;
    --shadow:0 10px 30px rgba(0,0,0,.5);
    --switch-handle:#f1f5f9;
  }
}

:root[data-theme='dark'] {
  --bg: linear-gradient(180deg,#0f172a 0%,#1e293b 100%);
  --card:#1e293b;
  --ink:#f1f5f9;
  --muted:#cbd5e1;
  --accent:#3b82f6;
  --accent2:#34d399;
  --border:#334155;
  --shadow:0 10px 30px rgba(0,0,0,.5);
  --switch-handle:#f1f5f9;
}

:root[data-theme='light'] {
  --bg: linear-gradient(180deg,#f8fafc 0%,#eef2ff 100%);
  --card:#fff;
  --ink:#0f172a;
  --muted:#475569;
  --accent:#2563eb;
  --accent2:#10b981;
  --border:#e2e8f0;
  --shadow:0 10px 30px rgba(2,6,23,.08);
  --switch-handle:#fff;
}

*{box-sizing:border-box}
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";color:var(--ink);background:var(--bg)}
input,textarea,select{color:var(--ink)}
body.editing-open{overflow:hidden;}

.page{max-width:1280px;margin:40px auto;padding:24px;width:100%}
.card{background:var(--card);border:1px solid var(--border);border-radius:20px;box-shadow:var(--shadow);overflow:visible;width:100%}
header{padding:28px 28px 10px 28px;display:grid;grid-template-columns:1fr auto;gap:16px;align-items:start}
.title{font-size:28px;font-weight:800;letter-spacing:.2px}
.subtitle{margin-top:6px;color:var(--muted);font-size:14px}
.toolbar{display:flex;gap:10px;flex-wrap:wrap;position:relative;align-items:center}
.toolbarButtons{display:flex;gap:10px;flex-wrap:wrap}
.themeSwitch{position:relative;display:inline-block;width:46px;height:24px}
.themeSwitch input{opacity:0;width:0;height:0}
.themeSwitch .slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background:var(--border);transition:background .2s;border-radius:34px}
.themeSwitch .slider:before{position:absolute;content:"";height:20px;width:20px;left:2px;bottom:2px;background:var(--switch-handle);border-radius:50%;transition:transform .2s;box-shadow:var(--shadow)}
.themeSwitch input:checked+.slider{background:var(--accent)}
.themeSwitch input:checked+.slider:before{transform:translateX(22px)}
.menuBtn{display:none;border:1px solid var(--border);background:var(--card);padding:10px 14px;border-radius:12px;cursor:pointer;font-weight:600;box-shadow:var(--shadow)}
button{border:1px solid var(--border);background:var(--card);padding:10px 14px;border-radius:12px;cursor:pointer;font-weight:600;color:var(--ink);box-shadow:var(--shadow);transition:background-color .2s,color .2s,transform .1s}
button.primary{background:var(--accent);color:#fff;border-color:var(--accent)}
button.success{background:var(--accent2);color:#fff;border-color:var(--accent2)}
button.danger{background:#ef4444;color:#fff;border-color:#ef4444}
button:active{transform:translateY(1px)}
.meta{display:grid;grid-template-columns:repeat(4,1fr);gap:14px;padding:0 28px 18px 28px}
.meta .field{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:10px 12px;min-width:0}
.meta label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
.meta input{width:100%;border:none;outline:none;background:transparent;font-weight:600}
.progressWrap{position:sticky;top:0;z-index:20;padding:10px 28px 2px 28px;background:var(--card);box-shadow:var(--shadow)}
.progressLabel{display:flex;justify-content:space-between;font-size:12px;color:var(--muted);margin-bottom:6px}
.progress{height:12px;background:var(--card);border:1px solid var(--border);border-radius:999px;overflow:hidden;position:relative}
.bar{height:100%;width:0%;background:linear-gradient(90deg,var(--accent),var(--accent2));transition:width .25s ease}
.sectionTitle{padding:14px 28px 6px 28px;font-weight:800;color:var(--ink);letter-spacing:.2px}

/* Notes header + summary */
.notesSummary,
.notesHeader{ display:flex; align-items:center; justify-content:space-between; }
.notesSummary{cursor:pointer;}
.notesSummary::-webkit-details-marker{display:none;}
.notesSummary::marker{content:"";}
.notesSummary::after{content:'▼';font-size:18px;}
#notesPanel[open] .notesSummary::after{content:'▲';}
.notesHeader button{border:none;background:none;font-size:18px;cursor:pointer;line-height:1;padding:0;transition:transform .15s;}
.notesHeader button:hover{transform:scale(1.1);}

/* Add form (responsive) */
.addForm{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:10px;padding:0 28px 12px}
.addForm input,.addForm textarea,.addForm select{border:1px solid var(--border);border-radius:12px;padding:10px;min-width:0;width:100%}
.addForm select{-webkit-appearance:none;appearance:none;padding-right:32px;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6' viewBox='0 0 10 6'%3E%3Cpath fill='%23677389' d='M5 6L0 0h10z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 12px center;background-size:10px}
.addForm .dateInputs{display:grid;grid-template-columns:1fr 1fr;gap:8px;width:100%}
.addForm .dateInputs input{ text-align:center; }

/* Tasks */
ul.tasks{list-style:none;margin:0;padding:8px 18px 24px 18px;display:grid;gap:10px}
.task{border:1px solid var(--border);border-radius:16px;padding:12px;display:grid;grid-template-columns:26px 28px minmax(0,1fr) auto;gap:12px;align-items:start;background:var(--card)}
.task input[type="checkbox"]{margin-top:4px;transform:scale(1.35);accent-color:var(--accent2);cursor:pointer}
.task label{font-weight:700;display:block}
.desc{color:var(--muted);font-size:13px;margin-top:4px;word-break:break-word;overflow-wrap:anywhere}
.note{margin-top:10px;width:100%;border:1px solid var(--border);padding:10px 12px;border-radius:10px;font-size:13px;word-break:break-word;overflow-wrap:anywhere}
.del{border:1px solid #fecaca;background:#fee2e2;color:#b91c1c}
.badge{display:inline-block;font-size:11px;font-weight:700;color:#065f46;background:#d1fae5;border:1px solid #a7f3d0;padding:3px 8px;border-radius:999px;margin-left:6px}
.notesWrap{padding:0 28px 28px 28px;display:grid;grid-template-columns:1fr 1fr;gap:16px}
.notesWrap textarea{width:100%;min-height:150px;border:1px solid var(--border);border-radius:12px;padding:12px;min-width:0}
footer{padding:14px 28px 28px 28px;color:var(--muted);font-size:12px}

button.fab{display:none;width:56px;height:56px;border-radius:50%;background:var(--accent);color:#fff;border:none;font-size:32px;line-height:1;box-shadow:var(--shadow);justify-content:center;align-items:center}
#addModal .box{width:90%;max-width:500px}
#addModal .addForm{padding:0;grid-template-columns:1fr}

/* Filters side panel */
.filters-panel{position:fixed;inset:0;background:rgba(0,0,0,.4);transform:translateX(100%);transition:transform .3s ease;display:flex;justify-content:flex-end;pointer-events:none;z-index:1000}
.filters-panel .panel{width:80%;max-width:360px;background:var(--card);padding:20px;height:100%;overflow:auto;box-shadow:var(--shadow)}
.filters-panel.open{transform:translateX(0);pointer-events:auto}
@media (min-width:769px){
  .filters-panel{position:static;transform:none;background:none;display:block;pointer-events:auto;transition:none}
  .filters-panel .panel{width:auto;max-width:none;padding:0;height:auto;box-shadow:none}
}

/* Mobile */
@media (max-width:768px){
  header{display:flex;flex-direction:column;gap:12px;align-items:stretch}
  .titleWrap{order:2;text-align:center}
  .toolbar{order:1;flex-wrap:nowrap}
  .toolbar #menuBtn{order:1}
  .toolbar #filtersBtn{order:2;margin-left:auto}
  .toolbar .themeSwitch{order:3}
  .meta{grid-template-columns:1fr 1fr}
  .addForm{grid-template-columns:1fr}
  .notesWrap{grid-template-columns:1fr}
  .filters{grid-template-columns:1fr 1fr}
  .toolbarButtons{display:none;flex-direction:column;position:absolute;top:100%;left:0;background:var(--card);padding:10px;border:1px solid var(--border);border-radius:12px;gap:10px}
  .toolbar.open .toolbarButtons{display:flex}
  .menuBtn{display:block}
}
@media (max-width:480px){
  .page{padding:12px}
  .meta{grid-template-columns:1fr;padding:0 12px 18px}
  ul.tasks{grid-template-columns:1fr}
  .notesWrap{grid-template-columns:1fr;padding:0 12px 28px}
  .filters{grid-template-columns:1fr;padding:0 12px 12px}
  #addSectionTitle,.sidebar .addForm{display:none}
  button.fab{display:flex;position:fixed;bottom:20px;right:20px}
  .tagPrio{grid-template-columns:1fr}
  .editForm .dateInputs{grid-template-columns:1fr}
  .addForm .dateInputs{grid-template-columns:1fr}
  .task{grid-template-columns:26px 28px minmax(0,1fr) auto;gap:8px;padding:10px}
  /* Full-screen editor on mobile */
  .task.editing{
    grid-template-columns:1fr;
    position:fixed;
    inset:0;
    padding:20px 16px;
    background:var(--card);
    border-radius:0;
    overflow:auto;
    z-index:1000;
    box-shadow:none;
    border:none;
    animation:slideUp .25s ease;
  }
  .task.editing .handle,
  .task.editing > input[type="checkbox"]{ display:none; }
  .editForm input, .editForm textarea, .editForm select{font-size:16px;padding:14px;}
  .editBtns{flex-direction:column;gap:10px;}
  .editBtns button{width:100%;}
}

/* Desktop wide */
@media (min-width:1024px){
  .page{max-width:1280px}
  .card{display:grid;grid-template-columns:2fr 1fr;}
  .card>header{grid-column:1/-1}
  .filters, .addForm{grid-template-columns:repeat(auto-fit,minmax(220px,1fr));}
}

@media (max-width:1023px){
  .card{display:block}
}

/* Print */
@media print{
  body{background:var(--card)}
  .page{margin:0}
  .toolbar,.filters,.meta,.notesWrap,footer{display:none}
  .card{box-shadow:none}
  button{display:none}

  ul.tasks{padding:0}
  .task{box-shadow:none;border:1px solid #d1d5db;border-radius:8px;padding:6px;background:transparent}
  .task .handle,.task .actions{display:none}
  .task input[type="checkbox"]{transform:none;margin-top:0}
}

/* Filters bar (responsive) */
.filters{padding:0 28px 12px;display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:10px}
.filters input:not([type="checkbox"]),.filters select{border:1px solid var(--border);border-radius:12px;padding:10px;background:var(--card);width:100%;min-width:0}
.filters select{-webkit-appearance:none;appearance:none;padding-right:32px;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6' viewBox='0 0 10 6'%3E%3Cpath fill='%23677389' d='M5 6L0 0h10z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 12px center;background-size:10px}
.filters .onlyPending input{width:auto;transform:scale(1.2);accent-color:var(--accent2)}
.filters .onlyPending{display:flex;align-items:center;gap:8px;min-width:0}

/* Tag chips & priority badges */
.chips{margin-top:6px;display:flex;gap:6px;flex-wrap:wrap}
.chip{font-size:11px;padding:3px 8px;border-radius:999px;border:1px solid var(--border);background:var(--card)}
.badge.p1{background:#fee2e2;border-color:#fecaca;color:#991b1b} /* High */
.badge.p2{background:#dbeafe;border-color:#bfdbfe;color:#1e3a8a} /* Medium */
.badge.p3{background:#dcfce7;border-color:#bbf7d0;color:#14532d} /* Low */

/* Drag handle */
.handle{cursor:grab;user-select:none;font-size:18px;line-height:1;padding:4px 6px}
.task.dragging{opacity:.6}

/* ===== Task Card Redesign ===== */
ul.tasks { gap: 14px; padding: 10px 18px 28px 18px; }

.task{
  display: grid;
  grid-template-columns: 26px 28px minmax(0,1fr) auto; /* handle | checkbox | content | actions */
  align-items: center;
  gap: 12px;
  padding: 12px 12px;
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 16px;
  box-shadow: var(--shadow);
  transition: transform .12s ease, box-shadow .12s ease, border-color .12s ease, background-color .12s ease;
}
.task:hover{ transform: translateY(-1px); border-color:var(--border); box-shadow: 0 10px 24px rgba(2,6,23,.10); }

.task .handle{
  cursor: grab; user-select: none; color:var(--muted);
  display:flex; align-items:center; justify-content:center;
  width: 22px; height: 22px; border-radius: 6px;
  transition: color .2s, transform .15s;
}
.task .handle:hover{ color:var(--ink); transform:scale(1.1); }
.task .handle:active{ cursor: grabbing; }

.task input[type="checkbox"]{ margin: 0 auto; transform: scale(1.25); accent-color: var(--accent2); }

.task .content{ display: grid; row-gap: 6px; min-width:0; }
.task .content .titleRow{ display:flex; align-items:center; gap:8px; flex-wrap:wrap; }
.task .content label{ font-weight: 800; font-size: 15px; display: inline; }
.task .desc{ color:var(--muted); font-size: 13px; margin: 0; word-break:break-word; overflow-wrap:anywhere; }
.task .note{ margin-top: 4px; font-size: 13px; word-break:break-word; overflow-wrap:anywhere; }

.task .actions{ display:flex; align-items:center; justify-content:flex-end; align-self:flex-start; }
.task .del{
  border: 1px solid var(--border); background: transparent; color:var(--muted);
  width: 32px; height: 32px; border-radius: 10px; display:flex; align-items:center; justify-content:center;
  transition: background-color .2s, color .2s, transform .15s;
}
.task .del:hover{ background:#fee2e2; border-color:#fecaca; color:#991b1b; transform:scale(1.1); }

.actions{ display:flex; gap:8px; justify-content:flex-end; align-items:center; }
.actions .edit{
  border: 1px solid var(--border); background: transparent; color:var(--ink);
  width: 32px; height: 32px; border-radius: 10px; display:flex; align-items:center; justify-content:center;
  transition: background-color .2s, transform .15s;
}
.actions .edit:hover{ background:var(--border); transform:scale(1.1); }

/* Completed state */
.task.done{ background:var(--card); }
.task.done label{ color:var(--muted); text-decoration: line-through; }

/* Task dates */
.task .dates{ font-size:12px; color:var(--muted); margin-top:4px; }
.task .dates .due{ color:var(--accent); font-weight:600; }

/* Editing state */
.task.editing{ grid-template-columns:1fr; }
.task.editing .handle,
.task.editing > input[type="checkbox"],
.task.editing .actions{ display:none; }

/* Edit form */
.hidden{ display:none !important; }
.task .editForm{ display:none; border:1px dashed var(--border); background:var(--card); padding:10px; border-radius:12px; margin-top:6px; }
.task.editing .editForm{ display:block; }
.editForm .row{ display:grid; grid-template-columns:1fr; gap:8px; }
.editForm input, .editForm textarea, .editForm select{ border:1px solid var(--border); border-radius:10px; padding:10px; width:100%; }
.editForm select{-webkit-appearance:none;appearance:none;padding-right:32px;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6' viewBox='0 0 10 6'%3E%3Cpath fill='%23677389' d='M5 6L0 0h10z'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 12px center;background-size:10px}
.tagPrio{ display:grid; grid-template-columns:1fr 1fr; gap:8px; }
.editForm .dateInputs{ display:grid; grid-template-columns:1fr 1fr; gap:8px; }
.editForm .dateInputs input{ text-align:center; }
.editBtns{ display:flex; gap:8px; justify-content:flex-end; }

/* Notes thread */
.taskNotes{ margin-top:6px; }
.taskNotes summary{ cursor:pointer; display:flex; align-items:center; justify-content:space-between; font-weight:600; }
.taskNotes summary::-webkit-details-marker{ display:none; }
.taskNotes summary::marker{ content:""; }
.taskNotes summary::after{ content:'▼'; font-size:14px; transition:transform .2s; }
.taskNotes[open] summary::after{ transform:rotate(180deg); }
.addNote{ margin-top:6px; display:flex; gap:8px; }

.modal{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.4);display:flex;align-items:center;justify-content:center;animation:fadeIn .25s;z-index:200;}
.modal.hidden{display:none;}
.modal .box{background:var(--card);padding:20px;border-radius:12px;box-shadow:var(--shadow);text-align:center;animation:scaleIn .25s;}
.modal .actions{margin-top:16px;display:flex;gap:10px;justify-content:center;}
.modal .modalTitle{margin-top:0;margin-bottom:16px;font-size:20px;font-weight:800;}
@keyframes fadeIn{from{opacity:0;}to{opacity:1;}}
@keyframes scaleIn{from{transform:scale(.9);}to{transform:scale(1);} }
@keyframes slideUp{from{transform:translateY(20px);opacity:0;}to{transform:translateY(0);opacity:1;}}
.addNote input{ flex:1; border:1px solid var(--border); border-radius:10px; padding:8px 10px; }
.addNote button{ border:1px solid var(--border); border-radius:10px; padding:6px 10px; background:var(--card); transition:background-color .2s, transform .15s; }
.addNote button:hover{ background:var(--border); transform:scale(1.1); }

.notesThread{ margin-top:6px; border-left:3px solid var(--border); padding-left:10px; display:grid; gap:6px; }
.noteItem{ background:var(--card); border:1px solid var(--border); border-radius:10px; padding:8px 10px; word-break:break-word; overflow-wrap:anywhere; }
.noteMeta{ font-size:11px; color:var(--muted); margin-top:2px; }

.noteItem .noteRow{ display:flex; gap:8px; align-items:flex-start; justify-content:space-between; }
.noteDel{
  border:1px solid var(--border);
  background:var(--card);
  border-radius:8px;
  padding:3px 6px;
  cursor:pointer;
  font-size:12px;
  transition:background-color .2s, color .2s, transform .15s;
}
.noteDel:hover{
  background:#fee2e2; border-color:#fecaca; color:#991b1b; transform:scale(1.1);
}
